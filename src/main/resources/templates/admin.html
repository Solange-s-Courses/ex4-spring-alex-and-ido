<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }

    .navbar {
      background-color: #343a40;
      padding: 1rem 0;
    }

    .navbar-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .navbar-brand {
      color: white;
      text-decoration: none;
      font-size: 1.25rem;
      font-weight: bold;
    }

    .navbar-nav {
      display: flex;
      gap: 20px;
    }

    .nav-link {
      color: rgba(255,255,255,0.75);
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 4px;
      transition: color 0.3s;
    }

    .nav-link:hover {
      color: white;
      background-color: rgba(255,255,255,0.1);
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 20px;
    }

    h1 {
      color: #333;
      margin-bottom: 0.5rem;
    }

    .text-muted {
      color: #6c757d;
      margin-bottom: 2rem;
    }

    /* Alert Messages */
    .alert {
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
    }

    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* User List Styles */
    .user-list-section {
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-top: 2rem;
    }

    .user-list-header {
      border-bottom: 2px solid #007bff;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }

    .user-list-header h2 {
      color: #007bff;
      margin: 0;
      font-size: 1.5rem;
    }

    .user-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      background-color: #f8f9fa;
      transition: background-color 0.3s;
    }

    .user-item:hover {
      background-color: #e9ecef;
    }

    .user-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .user-name {
      font-weight: bold;
      color: #333;
      font-size: 1.1rem;
    }

    .user-role {
      color: #007bff;
      font-size: 0.9rem;
      text-transform: uppercase;
      font-weight: 500;
    }

    .user-phone {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .user-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      text-decoration: none;
      transition: background-color 0.3s;
    }

    .btn-edit {
      background-color: #28a745;
      color: white;
    }

    .btn-edit:hover {
      background-color: #218838;
    }

    .btn-delete {
      background-color: #dc3545;
      color: white;
    }

    .btn-delete:hover {
      background-color: #c82333;
    }

    .no-users {
      text-align: center;
      color: #6c757d;
      font-style: italic;
      padding: 2rem;
    }

    .user-count {
      color: #6c757d;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 500px;
      max-width: 90%;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .modal h3 {
      margin-bottom: 1rem;
      text-align: center;
    }

    .modal p {
      margin-bottom: 1.5rem;
      color: #333;
      text-align: center;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .btn-confirm {
      background-color: #dc3545;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-cancel {
      background-color: #6c757d;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Edit Modal Styles */
    .edit-modal .modal-content {
      text-align: left;
    }

    .edit-modal h3 {
      color: #28a745;
      text-align: center;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
      color: #333;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #007bff;
    }

    .btn-save {
      background-color: #28a745;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Tooltip Styles */
    .user-name {
      font-weight: bold;
      color: #333;
      font-size: 1.1rem;
      position: relative;
      cursor: help;
      transition: color 0.3s;
    }

    .user-name:hover {
      color: #007bff;
    }

    .tooltip {
      position: absolute;
      background-color: #333;
      color: white;
      padding: 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: normal;
      white-space: nowrap;
      z-index: 1001;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 300px;
      white-space: normal;
      line-height: 1.4;
      cursor: default; /* Allow text selection */
      user-select: text; /* Enable text selection */
      border: 1px solid #555; /* Slight border for better definition */
    }

    .tooltip::before {
      content: '';
      position: absolute;
      top: -6px;
      left: 20px;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-bottom: 6px solid #333;
    }

    .tooltip.show {
      opacity: 1;
      visibility: visible;
    }

    .tooltip-row {
      margin-bottom: 4px;
      padding: 1px 0;
      user-select: text;
      cursor: text;
    }

    .tooltip-label {
      font-weight: bold;
      color: #ffd700;
      min-width: 80px;
      display: inline-block;
    }
  </style>
</head>
<body>
<nav class="navbar">
  <div class="navbar-container">
    <a class="navbar-brand">Event Management System</a>
    <div class="navbar-nav">
      <a th:href="@{/dashboard}" class="nav-link">Back to Dashboard</a>
    </div>
  </div>
</nav>

<div class="container">
  <h1>Admin Dashboard</h1>
  <p class="text-muted">Manage users and system settings</p>

  <!-- Alert Messages -->
  <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
  <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

  <!-- User List Section -->
  <div class="user-list-section">
    <div class="user-list-header">
      <h2>User Management</h2>
    </div>

    <div class="user-count" th:if="${users != null}">
      Total Users: <span th:text="${#lists.size(users)}">0</span>
    </div>

    <div th:if="${users != null and not #lists.isEmpty(users)}">
      <div class="user-item" th:each="userItem : ${users}">
        <div class="user-info">
          <div class="user-name"
               th:text="${#strings.capitalize(userItem.firstName) + ' ' + #strings.capitalize(userItem.lastName)}"
               th:data-user-id="${userItem.userId}"
               th:data-user-email="${userItem.emailAddress}"
               th:data-user-phone="${userItem.phoneNumber}"
               th:data-user-role="${userItem.roleName}"
               th:data-user-date="${#temporals.format(userItem.dateOfIssue, 'dd/MM/yyyy')}"
               onmouseenter="showTooltip(this)"
               onmouseleave="hideTooltip(this)">
            User Name
          </div>          <div class="user-role" th:text="${userItem.roleName}">Role</div>
          <div class="user-phone" th:text="${userItem.phoneNumber}">Phone</div>
        </div>
        <div class="user-actions">
          <button class="btn btn-edit" type="button"
                  th:data-user-id="${userItem.userId}"
                  th:data-user-fname="${userItem.firstName}"
                  th:data-user-lname="${userItem.lastName}"
                  th:data-user-role="${userItem.roleName}"
                  th:data-user-name="${#strings.capitalize(userItem.firstName) + ' ' + #strings.capitalize(userItem.lastName)}"
                  onclick="showEditModal(this.dataset.userId, this.dataset.userFname, this.dataset.userLname, this.dataset.userRole, this.dataset.userName)">
            Edit
          </button>
          <button class="btn btn-delete" type="button"
                  th:data-user-id="${userItem.userId}"
                  th:data-user-name="${#strings.capitalize(userItem.firstName) + ' ' + #strings.capitalize(userItem.lastName)}"
                  onclick="showDeleteModal(this.dataset.userId, this.dataset.userName)">
            Delete
          </button>
        </div>
      </div>
    </div>

    <div th:if="${users == null or #lists.isEmpty(users)}" class="no-users">
      No users found in the system.
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div id="editModal" class="modal edit-modal">
  <div class="modal-content">
    <h3>Edit User</h3>
    <form id="editForm" method="post" th:action="@{/admin/edit-user}">
      <input type="hidden" id="editUserId" name="userId" />

      <div class="form-group">
        <label for="editFirstName">First Name:</label>
        <input type="text" id="editFirstName" name="firstName" required maxlength="20" pattern="[A-Za-z]+" />
      </div>

      <div class="form-group">
        <label for="editLastName">Last Name:</label>
        <input type="text" id="editLastName" name="lastName" required maxlength="20" pattern="[A-Za-z]+" />
      </div>

      <div class="form-group">
        <label for="editRole">Role:</label>
        <select id="editRole" name="roleName" required>
          <option th:each="role : ${roles}" th:value="${role.name}" th:text="${#strings.capitalize(role.name)}">Role</option>
        </select>
      </div>

      <div class="modal-buttons">
        <button type="submit" class="btn-save">Save Changes</button>
        <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h3>Confirm Delete</h3>
    <p id="deleteMessage">Are you sure you want to delete this user?</p>
    <div class="modal-buttons">
      <button class="btn-confirm" onclick="confirmDelete()">Yes, Delete</button>
      <button class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Hidden form for deletion -->
<form id="deleteForm" method="post" th:action="@{/admin/delete-user}" style="display: none;">
  <input type="hidden" id="userIdToDelete" name="userId" />
</form>

<script>
  let userIdToDelete = null;
  let tooltipTimeout;
  let hideTimeout;
  let currentTooltip = null;
  let isTooltipHovered = false;

  function showTooltip(element) {
    // Clear any existing timeouts
    if (tooltipTimeout) {
      clearTimeout(tooltipTimeout);
    }
    if (hideTimeout) {
      clearTimeout(hideTimeout);
    }

    // Set timeout for 1 second
    tooltipTimeout = setTimeout(() => {
      // Remove any existing tooltip
      hideTooltipImmediate();

      // Create tooltip content
      const userId = element.dataset.userId;
      const userEmail = element.dataset.userEmail;
      const userPhone = element.dataset.userPhone;
      const userRole = element.dataset.userRole;
      const userDate = element.dataset.userDate;
      const userName = element.textContent;

      const tooltipContent = `
      <div class="tooltip-row"><span class="tooltip-label">UserID:</span> ${userId}</div>
      <div class="tooltip-row"><span class="tooltip-label">FullName:</span> ${userName}</div>
      <div class="tooltip-row"><span class="tooltip-label">Email:</span> ${userEmail}</div>
      <div class="tooltip-row"><span class="tooltip-label">Phone:</span> ${userPhone}</div>
      <div class="tooltip-row"><span class="tooltip-label">Role:</span> ${userRole.toUpperCase()}</div>
      <div class="tooltip-row"><span class="tooltip-label">Member Since:</span> ${userDate}</div>
    `;

      // Create tooltip element
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip';
      tooltip.innerHTML = tooltipContent;

      // Add mouse events to tooltip itself
      tooltip.addEventListener('mouseenter', () => {
        isTooltipHovered = true;
        if (hideTimeout) {
          clearTimeout(hideTimeout);
        }
      });

      tooltip.addEventListener('mouseleave', () => {
        isTooltipHovered = false;
        hideTooltipDelayed();
      });

      // Position tooltip
      const rect = element.getBoundingClientRect();
      tooltip.style.left = (rect.left + window.scrollX) + 'px';
      tooltip.style.top = (rect.bottom + window.scrollY + 5) + 'px';

      // Add to document
      document.body.appendChild(tooltip);
      currentTooltip = tooltip;

      // Show tooltip with animation
      setTimeout(() => {
        if (currentTooltip === tooltip) {
          tooltip.classList.add('show');
        }
      }, 10);

    }, 1000); // 1-second delay
  }

  function hideTooltip(element) {
    // Clear show timeout
    if (tooltipTimeout) {
      clearTimeout(tooltipTimeout);
      tooltipTimeout = null;
    }

    // Don't hide immediately, use a small delay to allow moving to tooltip
    hideTooltipDelayed();
  }

  function hideTooltipDelayed() {
    // Clear any existing hide timeout
    if (hideTimeout) {
      clearTimeout(hideTimeout);
    }

    // Set a small delay before hiding to allow mouse movement to tooltip
    hideTimeout = setTimeout(() => {
      if (!isTooltipHovered) {
        hideTooltipImmediate();
      }
    }, 100); // Small delay to allow mouse movement
  }

  function hideTooltipImmediate() {
    // Clear all timeouts
    if (tooltipTimeout) {
      clearTimeout(tooltipTimeout);
      tooltipTimeout = null;
    }
    if (hideTimeout) {
      clearTimeout(hideTimeout);
      hideTimeout = null;
    }

    // Remove current tooltip
    if (currentTooltip) {
      currentTooltip.remove();
      currentTooltip = null;
    }

    isTooltipHovered = false;
  }

  // Edit Modal Functions
  function showEditModal(userId, firstName, lastName, role) {
    document.getElementById('editUserId').value = userId;
    document.getElementById('editFirstName').value = firstName.charAt(0).toUpperCase() + firstName.slice(1);
    document.getElementById('editLastName').value = lastName.charAt(0).toUpperCase() + lastName.slice(1);
    document.getElementById('editRole').value = role;
    document.getElementById('editModal').style.display = 'block';
  }

  function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
  }

  // Delete Modal Functions
  function showDeleteModal(userId, userName) {
    userIdToDelete = userId;
    document.getElementById('deleteMessage').textContent =
            'Are you sure you want to delete ' + userName + '? This action cannot be undone.';
    document.getElementById('deleteModal').style.display = 'block';
  }

  function confirmDelete() {
    if (userIdToDelete) {
      document.getElementById('userIdToDelete').value = userIdToDelete;
      document.getElementById('deleteForm').submit();
    }
  }

  function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
    userIdToDelete = null;
  }

  // Close modals when clicking outside
  window.onclick = function(event) {
    const editModal = document.getElementById('editModal');
    const deleteModal = document.getElementById('deleteModal');

    if (event.target === editModal) {
      closeEditModal();
    }
    if (event.target === deleteModal) {
      closeDeleteModal();
    }
  }
</script>
</body>
</html>