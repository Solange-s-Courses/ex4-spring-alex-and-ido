<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Items Table Fragment with Tab System -->
<div th:fragment="table(items, itemCount, requests, requestCount)" class="items-main">
    <div class="items-content">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('items')" id="itemsTab">
                <i class="icon">ðŸ“¦</i> Items
                <span class="tab-count" th:if="${itemCount != null and itemCount != 0}" th:text="${itemCount}"></span>
            </button>
            <button class="tab-btn" onclick="switchTab('requests')" id="requestsTab">
                <i class="icon">ðŸ“‹</i> Requests
                <span class="tab-count" th:if="${requestCount != null and requestCount != 0}" th:text="${requestCount}"></span>
            </button>
        </div>

        <!-- Items Tab Content -->
        <div id="itemsContent" class="tab-content active">
            <!-- Items Header -->
            <div class="items-header">
                <div class="header-content">
                    <h2 class="items-title">
                        <i class="icon">ðŸ“¦</i> Items Management
                    </h2>
                    <div class="item-count" th:if="${itemCount != null}">
                        <span th:text="${itemCount}">0</span> items total
                    </div>
                </div>
                <button class="add-item-btn" onclick="showAddItemModal()">
                    <i class="icon">âž•</i> Add New Item
                </button>
            </div>

            <!-- Items Table -->
            <div class="items-table-container">
                <div th:if="${items != null and not #lists.isEmpty(items)}">
                    <table class="items-table">
                        <thead>
                        <tr>
                            <th>Item Name</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="item : ${items}">
                            <td data-label="Item Name" th:text="${item.itemName}">Item Name</td>
                            <td data-label="Status">
                                <span class="status-badge"
                                      th:classappend="${item.status == 'Available' ? 'status-available' :
                                    (item.status == 'In Use' ? 'status-in-use' : 'status-unavailable')}"
                                      th:text="${item.status == 'In Use' && item.userFullName != null ?
                                    'In Use by ' + #strings.capitalizeWords(item.userFullName) : item.status}">
                                    Status
                                </span>
                            </td>
                            <td data-label="Actions">
                                <div class="item-actions">
                                    <!-- Check if item has pending requests -->
                                    <div th:with="requestStatus=${@itemService.getItemRequestStatus(item.itemId, requests)}">
                                        <!-- Show request status message if there are pending requests -->
                                        <div th:if="${requestStatus != null}" class="request-status-message">
                                            <span class="status-pending" th:text="${requestStatus}">Status</span>
                                        </div>

                                        <!-- Show edit/delete buttons only if no requests and not in use -->
                                        <div th:if="${requestStatus == null and !item.isInUse()}">
                                            <button class="btn-edit-item"
                                                    th:data-item-id="${item.itemId}"
                                                    th:data-item-name="${item.itemName}"
                                                    th:data-item-status="${item.status}"
                                                    onclick="showEditItemModal(this.dataset.itemId, this.dataset.itemName, this.dataset.itemStatus)">
                                                Edit
                                            </button>
                                            <button class="btn-delete-item"
                                                    th:data-item-id="${item.itemId}"
                                                    th:data-item-name="${item.itemName}"
                                                    onclick="showDeleteItemModal(this.dataset.itemId, this.dataset.itemName)">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- No Items Message -->
                <div th:if="${items == null or #lists.isEmpty(items)}" class="no-items">
                    <div class="no-items-content">
                        <i class="icon">ðŸ“¦</i>
                        <h3>No Items Yet</h3>
                        <p>This responsibility list is empty. Add your first item to get started!</p>
                        <button class="add-item-btn-secondary" onclick="showAddItemModal()">
                            Add First Item
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Requests Tab Content -->
        <div id="requestsContent" class="tab-content">
            <!-- Requests Section Fragment -->
            <div th:replace="~{fragments/responsibility-manage/requests-section :: section(${requests}, ${requestCount}, ${responsibility})}"></div>
        </div>
    </div>
</div>

</html>