<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<div th:fragment="chiefUserList">
    <div class="user-list-section">
        <div class="user-list-header">
            <h2>User Management</h2>
        </div>

        <!-- Filter, Search and Count Section -->
        <div class="user-list-controls" th:if="${users != null}">
            <div class="filter-section">
                <label for="roleFilter" class="filter-label">Filter by Role:</label>
                <select id="roleFilter" class="filter-dropdown" onchange="filterUsers()">
                    <option value="all">All Roles</option>
                    <option th:each="role : ${roles}" th:value="${role.name}" th:text="${#strings.capitalize(role.name)}">Role</option>
                </select>
            </div>

            <div class="user-count">
                Total Users: <span id="totalUserCount" th:text="${#lists.size(users)}">0</span>
                <span id="filteredUserCount" style="display: none;"></span>
            </div>

            <div class="search-section">
                <input type="text" id="userSearch" class="search-input"
                       placeholder="Search users by name..."
                       oninput="filterUsers()">
            </div>
        </div>

        <div th:if="${users != null and not #lists.isEmpty(users)}">
            <div class="user-item" th:each="userItem : ${users}"
                 th:data-user-role-filter="${userItem.roleName}"
                 th:data-user-search="${(userItem.firstName + ' ' + userItem.lastName).toLowerCase()}">
                <div class="user-info">
                    <div class="user-name"
                         th:text="${#strings.capitalize(userItem.firstName) + ' ' + #strings.capitalize(userItem.lastName)}">
                        User Name
                    </div>
                    <div class="user-role"
                         th:id="'user-role-' + ${userItem.userId}"
                         th:text="${userItem.displayRole}">Role</div>
                    <div class="user-phone" th:text="${userItem.phoneNumber}">Phone</div>
                </div>
                <div class="user-actions">
                    <!-- Show Assign button if user has no responsibility -->
                    <button class="btn btn-assign" type="button"
                            th:data-user-id="${userItem.userId}"
                            th:data-user-name="${#strings.capitalize(userItem.firstName) + ' ' + #strings.capitalize(userItem.lastName)}"
                            th:if="${userItem.responsibilityName == null}"
                            onclick="showAssignModal(this.dataset.userId, this.dataset.userName)">
                        Assign Responsibility
                    </button>

                    <!-- Show Remove button if user has a responsibility -->
                    <button class="btn btn-remove" type="button"
                            th:data-user-id="${userItem.userId}"
                            th:data-user-name="${#strings.capitalize(userItem.firstName) + ' ' + #strings.capitalize(userItem.lastName)}"
                            th:data-responsibility-name="${userItem.responsibilityName}"
                            th:if="${userItem.responsibilityName != null}"
                            onclick="showRemoveModal(this.dataset.userId, this.dataset.userName, this.dataset.responsibilityName)">
                        Remove Responsibility
                    </button>
                </div>
            </div>
        </div>

        <div id="noFilteredUsers" th:if="${users == null or #lists.isEmpty(users)}" class="no-users">
            No users found in the system.
        </div>
    </div>

    <!-- Assign Responsibility Modal -->
    <div id="assignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Assign Responsibility</h3>
                <span class="close" onclick="closeAssignModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="assignMessage">Assign responsibility to user:</p>
                <form id="assignForm" th:action="@{/chief/assign-responsibility}" method="post">
                    <input type="hidden" id="assignUserId" name="userId">
                    <div class="form-group">
                        <label for="responsibilityName">Responsibility Name:</label>
                        <input type="text" id="responsibilityName" name="responsibilityName"
                               class="form-input" maxlength="100" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeAssignModal()">Cancel</button>
                <button type="button" class="btn btn-assign" onclick="confirmAssign()">Assign</button>
            </div>
        </div>
    </div>

    <!-- Remove Responsibility Modal -->
    <div id="removeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Remove Responsibility</h3>
                <span class="close" onclick="closeRemoveModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="removeMessage">Remove responsibility from user:</p>
                <form id="removeForm" th:action="@{/chief/remove-responsibility}" method="post">
                    <input type="hidden" id="removeUserId" name="userId">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeRemoveModal()">Cancel</button>
                <button type="button" class="btn btn-remove" onclick="confirmRemove()">Remove</button>
            </div>
        </div>
    </div>
</div>
</html>